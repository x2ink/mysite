# java实现TCP通信服务器群发给用户

## 客户端代码

```java
import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Scanner;
 
public class send {
    public static void main(String[] args) throws Exception{
        System.out.println("启动客户端成功");
        //连接与服务器端的Socket管道连接
        Socket socket=new Socket("127.0.0.1",7777);
        //创建一个独立的线程专门负责客户端的读消息
        new readmsg(socket).start();
        //从socket管道中得到一个字节输出流管道
        OutputStream os=socket.getOutputStream();
        //将低级的字节输出流包装成高级的打印流
        PrintStream ps=new PrintStream(os);
        //发送数据
        Scanner in=new Scanner(System.in);
        while (true){
            System.out.println("请输入发送的内容");
            String msg=in.nextLine();
            ps.println(msg);
            ps.flush();
        }
    }
}
class readmsg extends Thread{
    private Socket socket;
    public readmsg(Socket socket){
        this.socket=socket;
    }
    @Override
    public void run() {
        try {
            //字节输入流
            InputStream is=socket.getInputStream();
            //把低级的字节输入流包装成高级的缓存字符输入流
            BufferedReader br=new BufferedReader(new InputStreamReader(is));
            String msg;
            while ((msg=br.readLine())!=null){
                System.out.println("收到消息:"+msg);
            }
        }catch (Exception e){
            System.out.println("服务器把你踢出去啦");
        }
    }
}
```

## 服务的代码

```java
import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.ArrayList;
 
public class receive {
    public static ArrayList<Socket> all_online=new ArrayList<>();
    public static void main(String[] args) throws Exception {
        System.out.println("服务端启动");
        //注册端口
        ServerSocket serverSocket=new ServerSocket(7777);
        //循环接受客户端的socket的管道请求
        while (true){
            Socket socket=serverSocket.accept();
            System.out.println(socket.getRemoteSocketAddress()+"上线啦");
            all_online.add(socket);
            //创建一个独立的线程来单独处理这个socket管道
            new server_readmsg(socket).start();
        }
    }
}
class server_readmsg extends Thread{
    private Socket socket;
    public server_readmsg(Socket socket){
        this.socket=socket;
    }
 
    @Override
    public void run() {
        try {
            //字节输入流
            InputStream is=socket.getInputStream();
            //把低级的字节输入流包装成高级的缓存字符输入流
            BufferedReader br=new BufferedReader(new InputStreamReader(is));
            String msg;
            while ((msg=br.readLine())!=null){
                System.out.println(socket.getRemoteSocketAddress()+"发来了消息:"+msg);
                //把这个消息进行端口转发给全部客户
                send(msg);
            }
        }catch (Exception e){
            System.out.println(socket.getRemoteSocketAddress()+"下线");
        }
    }
    private void send(String msg) throws Exception {
        for (Socket socket:receive.all_online){
            PrintStream ps=new PrintStream(socket.getOutputStream());
            ps.println(msg);
            ps.flush();
        }
    }
}
```
